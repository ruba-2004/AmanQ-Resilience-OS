import{j as s,r as f,c as Q,a as b,p as A}from"./index-C-92nb6o.js";import{b as V,f as Y}from"./useDraftStore-BuyA3dDc.js";function X({server:a}){const e=a.status==="UP"?"saved":a.status==="DOWN"?"queued":"",n=a.latencyMs<80?"good":a.latencyMs<140?"warn":"bad";return s.jsxs("div",{className:"panel server-card",children:[s.jsxs("div",{className:"server-card-header",children:[s.jsxs("div",{className:"window-title",children:[s.jsx("span",{children:"ðŸ–¥ï¸"}),s.jsx("span",{children:a.id})]}),s.jsxs("div",{className:"server-status",children:[s.jsx("span",{className:`status-pill ${e}`,children:a.status}),s.jsxs("span",{className:`latency-chip ${n}`,children:[a.latencyMs," ms"]})]})]}),s.jsxs("div",{className:"metric-row",children:[s.jsx("span",{children:"CPU"}),s.jsxs("span",{children:[a.cpu,"%"]})]}),s.jsx("div",{className:"metric-bar",children:s.jsx("span",{style:{width:`${a.cpu}%`}})}),s.jsxs("div",{className:"metric-row",children:[s.jsx("span",{children:"RAM"}),s.jsxs("span",{children:[a.ram,"%"]})]}),s.jsx("div",{className:"metric-bar",children:s.jsx("span",{style:{width:`${a.ram}%`}})}),s.jsxs("div",{className:"metric-row",children:[s.jsx("span",{children:"Last Seen"}),s.jsxs("span",{children:[a.lastSeenSec,"s"]})]})]})}const k=[{from:"#63b3ff",to:"#7ee29e"},{from:"#a855f7",to:"#63b3ff"}];function Z({data:a}){const e=a.reduce((t,r)=>t+r.pct,0)||1,n=a.map(t=>({...t,pct:t.pct/e*100}));return s.jsxs("div",{className:"dashboard-chart-panel traffic",children:[s.jsxs("div",{className:"dashboard-chart-header",children:[s.jsxs("div",{children:[s.jsx("h4",{children:"Traffic Distribution"}),s.jsx("span",{className:"dashboard-chart-subtitle",children:"Load share per node"})]}),s.jsx("span",{className:"dashboard-chart-live",children:"Live"})]}),s.jsx("div",{className:"dashboard-chart-wrap traffic-bars",children:n.length===0?s.jsxs("div",{className:"dashboard-chart-empty",children:[s.jsx("span",{className:"dashboard-chart-empty-icon",children:"â‡„"}),s.jsx("p",{children:"Waiting for traffic..."})]}):s.jsxs("div",{className:"traffic-stack",children:[s.jsx("div",{className:"traffic-stack-bar",children:n.map((t,r)=>s.jsx("div",{className:"traffic-stack-segment",style:{width:`${t.pct}%`,background:`linear-gradient(90deg, ${k[r%2].from}, ${k[r%2].to})`,boxShadow:`0 0 20px ${k[r%2].from}40`},title:`${t.serverId}: ${t.pct.toFixed(0)}%`},t.serverId))}),s.jsx("div",{className:"traffic-legend",children:n.map((t,r)=>s.jsxs("div",{className:"traffic-legend-item",children:[s.jsx("span",{className:"traffic-legend-dot",style:{background:`linear-gradient(135deg, ${k[r%2].from}, ${k[r%2].to})`}}),s.jsx("span",{className:"traffic-legend-label",children:t.serverId}),s.jsxs("span",{className:"traffic-legend-pct",children:[t.pct.toFixed(0),"%"]})]},t.serverId))})]})})]})}const v=80,T=12,y=200,R=Math.PI*v;function J({value:a,max:e=100,label:n,unit:t="Mbps",deviceId:r}){const l=Math.max(1,Number(e)||100),c=Number(a),d=f.useMemo(()=>Math.max(0,Math.min(1,(Number.isFinite(c)?c:0)/l)),[c,l]),h=((S,L)=>{const g=S*Math.PI/180,M=L*Math.PI/180,D=y/2,P=y/2,F=D+v*Math.cos(g),q=P+v*Math.sin(g),_=D+v*Math.cos(M),z=P+v*Math.sin(M),K=Math.abs(L-S)>180?1:0;return`M ${F} ${q} A ${v} ${v} 0 ${K} 1 ${_} ${z}`})(180,0),p=R*(1-d),j=(180-d*180)*Math.PI/180,N=y/2+v*Math.cos(j),i=y/2+v*Math.sin(j);return s.jsxs("div",{className:"speed-gauge-card","data-device":r,children:[s.jsxs("div",{className:"speed-gauge-header",children:[s.jsxs("span",{className:"speed-gauge-device",children:["Device ",r]}),s.jsxs("span",{className:"speed-gauge-date",children:[new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})," ",new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]}),s.jsxs("div",{className:"speed-gauge-wrap",children:[s.jsxs("svg",{className:"speed-gauge-svg",viewBox:`0 0 ${y} ${y}`,"aria-hidden":!0,children:[s.jsx("path",{className:"speed-gauge-track",d:h,fill:"none",strokeWidth:T,strokeLinecap:"round"}),s.jsx("path",{className:"speed-gauge-fill",d:h,fill:"none",strokeWidth:T,strokeLinecap:"round",strokeDasharray:String(R),strokeDashoffset:String(p),style:{transition:"stroke-dashoffset 0.6s cubic-bezier(0.22, 1, 0.36, 1)"}}),s.jsx("circle",{className:"speed-gauge-handle",cx:N,cy:i,r:10,style:{transition:"cx 0.6s cubic-bezier(0.22, 1, 0.36, 1), cy 0.6s cubic-bezier(0.22, 1, 0.36, 1)"}}),s.jsx("circle",{className:"speed-gauge-handle-inner",cx:N,cy:i,r:6,style:{transition:"cx 0.6s cubic-bezier(0.22, 1, 0.36, 1), cy 0.6s cubic-bezier(0.22, 1, 0.36, 1)"}})]}),s.jsx("div",{className:"speed-gauge-label",children:n}),s.jsxs("div",{className:"speed-gauge-value",children:[Math.round(Number.isFinite(c)?c:0)," ",s.jsx("span",{className:"speed-gauge-unit",children:t})]})]})]})}const W=280,E=120,x={top:8,right:8,bottom:24,left:8},C=W-x.left-x.right,w=E-x.top-x.bottom;function I(a){if(!a.length)return"";const e=Math.max(...a,1),n=C/Math.max(a.length-1,1);return a.map((t,r)=>{const l=x.left+r*n,c=x.top+w-t/e*w;return`${r===0?"M":"L"}${l},${c}`}).join(" ")}function ss(a){const e=I(a);if(!e)return"";Math.max(...a,1);const n=C/Math.max(a.length-1,1),t=x.left+(a.length-1)*n,r=x.top+w;return`${e} L${t},${r} L${x.left},${r} Z`}function es(){const a=[];for(let e=1;e<=4;e++){const n=x.top+w/4*e;a.push(`M${x.left},${n} L${x.left+C},${n}`)}for(let e=1;e<=4;e++){const n=x.left+C/4*e;a.push(`M${n},${x.top} L${n},${x.top+w}`)}return a.join(" ")}function as({data:a}){const e=a.map(d=>d.ms),n=I(e),t=ss(e),r=es(),l=e.length?e[e.length-1]:null,c=e.length>=2?e[e.length-1]-e[e.length-2]:0;return s.jsxs("div",{className:"dashboard-chart-panel latency",children:[s.jsxs("div",{className:"dashboard-chart-header",children:[s.jsxs("div",{children:[s.jsx("h4",{children:"Latency"}),s.jsx("span",{className:"dashboard-chart-subtitle",children:"ms Â· lower is better"})]}),s.jsxs("div",{className:"dashboard-chart-badges",children:[l!=null&&s.jsxs("span",{className:"dashboard-chart-value",children:[l,s.jsx("span",{className:"dashboard-chart-unit",children:"ms"})]}),s.jsx("span",{className:"dashboard-chart-live",children:"Live"})]})]}),s.jsx("div",{className:"dashboard-chart-wrap",children:e.length===0?s.jsxs("div",{className:"dashboard-chart-empty",children:[s.jsx("span",{className:"dashboard-chart-empty-icon",children:"âš¡"}),s.jsx("p",{children:"Collecting data..."})]}):s.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${W} ${E}`,preserveAspectRatio:"none meet",className:"dashboard-chart-svg",children:[s.jsxs("defs",{children:[s.jsxs("linearGradient",{id:"latencyLineGrad",x1:"0",x2:"1",y1:"0",y2:"0",children:[s.jsx("stop",{offset:"0%",stopColor:"#63b3ff"}),s.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]}),s.jsxs("linearGradient",{id:"latencyAreaGrad",x1:"0",x2:"0",y1:"1",y2:"0",children:[s.jsx("stop",{offset:"0%",stopColor:"#63b3ff",stopOpacity:"0.35"}),s.jsx("stop",{offset:"100%",stopColor:"#a855f7",stopOpacity:"0.05"})]}),s.jsxs("filter",{id:"latencyGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[s.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),s.jsxs("feMerge",{children:[s.jsx("feMergeNode",{in:"blur"}),s.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),s.jsx("path",{d:r,fill:"none",stroke:"rgba(255,255,255,0.06)",strokeWidth:"0.5"}),s.jsx("path",{d:t,fill:"url(#latencyAreaGrad)"}),s.jsx("path",{d:n,fill:"none",stroke:"url(#latencyLineGrad)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",filter:"url(#latencyGlow)",className:"dashboard-chart-line"})]})}),e.length>0&&s.jsx("div",{className:"dashboard-chart-footer",children:c!==0&&s.jsxs("span",{className:c>0?"up":"down",children:[c>0?"â†‘":"â†“"," ",Math.abs(c)," ms"]})})]})}const H=280,B=120,m={top:8,right:8,bottom:24,left:8},O=H-m.left-m.right,$=B-m.top-m.bottom;function U(a){if(!a.length)return"";const e=Math.max(...a,1),n=O/Math.max(a.length-1,1);return a.map((t,r)=>{const l=m.left+r*n,c=m.top+$-t/e*$;return`${r===0?"M":"L"}${l},${c}`}).join(" ")}function ns(a){const e=U(a);if(!e)return"";const n=O/Math.max(a.length-1,1),t=m.left+(a.length-1)*n,r=m.top+$;return`${e} L${t},${r} L${m.left},${r} Z`}function ts(){const a=[];for(let e=1;e<=4;e++){const n=m.top+$/4*e;a.push(`M${m.left},${n} L${m.left+O},${n}`)}for(let e=1;e<=4;e++){const n=m.left+O/4*e;a.push(`M${n},${m.top} L${n},${m.top+$}`)}return a.join(" ")}function rs({data:a}){const e=a.map(d=>d.rps),n=U(e),t=ns(e),r=ts(),l=e.length?e[e.length-1]:null,c=e.length>=2?e[e.length-1]-e[e.length-2]:0;return s.jsxs("div",{className:"dashboard-chart-panel throughput",children:[s.jsxs("div",{className:"dashboard-chart-header",children:[s.jsxs("div",{children:[s.jsx("h4",{children:"Throughput"}),s.jsx("span",{className:"dashboard-chart-subtitle",children:"requests per second"})]}),s.jsxs("div",{className:"dashboard-chart-badges",children:[l!=null&&s.jsxs("span",{className:"dashboard-chart-value",children:[typeof l=="number"&&l%1!==0?l.toFixed(1):l,s.jsx("span",{className:"dashboard-chart-unit",children:"rps"})]}),s.jsx("span",{className:"dashboard-chart-live",children:"Live"})]})]}),s.jsx("div",{className:"dashboard-chart-wrap",children:e.length===0?s.jsxs("div",{className:"dashboard-chart-empty",children:[s.jsx("span",{className:"dashboard-chart-empty-icon",children:"ðŸ“ˆ"}),s.jsx("p",{children:"Collecting data..."})]}):s.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${H} ${B}`,preserveAspectRatio:"none meet",className:"dashboard-chart-svg",children:[s.jsxs("defs",{children:[s.jsxs("linearGradient",{id:"throughputLineGrad",x1:"0",x2:"1",y1:"0",y2:"0",children:[s.jsx("stop",{offset:"0%",stopColor:"#7ee29e"}),s.jsx("stop",{offset:"100%",stopColor:"#63b3ff"})]}),s.jsxs("linearGradient",{id:"throughputAreaGrad",x1:"0",x2:"0",y1:"1",y2:"0",children:[s.jsx("stop",{offset:"0%",stopColor:"#7ee29e",stopOpacity:"0.35"}),s.jsx("stop",{offset:"100%",stopColor:"#63b3ff",stopOpacity:"0.05"})]}),s.jsxs("filter",{id:"throughputGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[s.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),s.jsxs("feMerge",{children:[s.jsx("feMergeNode",{in:"blur"}),s.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),s.jsx("path",{d:r,fill:"none",stroke:"rgba(255,255,255,0.06)",strokeWidth:"0.5"}),s.jsx("path",{d:t,fill:"url(#throughputAreaGrad)"}),s.jsx("path",{d:n,fill:"none",stroke:"url(#throughputLineGrad)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",filter:"url(#throughputGlow)",className:"dashboard-chart-line"})]})}),e.length>0&&c!==0&&s.jsx("div",{className:"dashboard-chart-footer",children:s.jsxs("span",{className:c>0?"up":"down",children:[c>0?"â†‘":"â†“"," ",typeof c=="number"&&c%1!==0?Math.abs(c).toFixed(1):Math.abs(c)," rps"]})})]})}const cs=[{key:"status",label:"Status",icon:"â—",value:a=>(a==null?void 0:a.status)||"idle"},{key:"encryption",label:"Encryption",icon:"ðŸ”",value:a=>a!=null&&a.encryptionOk?"OK":"NO"},{key:"signature",label:"Signature",icon:"âœ±",value:a=>a!=null&&a.signatureOk?"OK":"NO"},{key:"pqReady",label:"PQ Ready",icon:"â—‡",value:a=>a!=null&&a.pqReady?"YES":"NO"}];function ls(a,e){return a?e==="status"?a.status==="done"||a.status==="idle":e==="encryption"?a.encryptionOk:e==="signature"?a.signatureOk:e==="pqReady"?a.pqReady:!1:!1}function ds({backup:a}){return s.jsxs("div",{className:"dashboard-chart-panel backup",children:[s.jsxs("div",{className:"dashboard-chart-header",children:[s.jsxs("div",{children:[s.jsx("h4",{children:"Backup & Security"}),s.jsx("span",{className:"dashboard-chart-subtitle",children:"Snapshot pipeline"})]}),s.jsx("span",{className:"dashboard-chart-badge-shield",children:"Protected"})]}),s.jsx("div",{className:"backup-status-grid",children:cs.map(({key:e,label:n,icon:t,value:r})=>s.jsxs("div",{className:`backup-status-item ${ls(a,e)?"ok":"warn"}`,children:[s.jsx("span",{className:"backup-status-icon",children:t}),s.jsxs("div",{className:"backup-status-content",children:[s.jsx("span",{className:"backup-status-label",children:n}),s.jsx("span",{className:"backup-status-value",children:r(a)})]})]},e))})]})}function is({events:a}){return s.jsxs("div",{children:[s.jsxs("div",{className:"panel-title",children:[s.jsxs("div",{children:[s.jsx("h4",{children:"Event Log"}),s.jsx("span",{className:"panel-subtitle",children:"Failovers and backups"})]}),s.jsx("span",{className:"panel-badge",children:"Live"})]}),s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{textAlign:"left"},children:"Time"}),s.jsx("th",{style:{textAlign:"left"},children:"Type"}),s.jsx("th",{style:{textAlign:"left"},children:"Server"}),s.jsx("th",{style:{textAlign:"left"},children:"Details"})]})}),s.jsxs("tbody",{children:[a.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:4,style:{opacity:.7},children:"No events yet."})}),a.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:new Date(e.time).toLocaleTimeString()}),s.jsx("td",{children:s.jsx("span",{className:"event-pill",children:e.type})}),s.jsx("td",{children:e.server||"-"}),s.jsx("td",{children:e.details})]},e.id))]})]})]})}function os({onScenarioDone:a}){const e=Q(),[n,t]=f.useState(null),[r,l]=f.useState(null),c=async p=>{t("shutdown"),l(p);try{const o=await b.wipeServers(p);await V(),await Y(),a({type:"shutdown",servers:p,backend:o})}catch(o){const j=o instanceof Error?o.message:String(o);A(`Shutdown failed: ${j}`)}finally{t(null),l(null)}},d=async p=>{t("lose-data"),l(p);try{const o=await b.wipeServers(p);a({type:"lose-data",servers:p,backend:o});const N=p[0]==="S1"?"/server1":"/server2";e(N,{state:{dataLost:!0}})}catch(o){const j=o instanceof Error?o.message:String(o);A(`Wipe failed: ${j}`)}finally{t(null),l(null)}},u=n!==null,h=(p,o)=>n!==o||!r?null:p.length===r.length&&p.every(N=>r.includes(N))?"â€¦":null;return s.jsxs("div",{className:"dashboard-chart-panel scenarios",children:[s.jsx("div",{className:"dashboard-chart-header",children:s.jsxs("div",{children:[s.jsx("h4",{children:"Demo scenarios"}),s.jsx("span",{className:"dashboard-chart-subtitle",children:"Shutdown: wipes server and clears drafts. Lose data: wipes server only; drafts kept for recovery."})]})}),s.jsxs("div",{className:"scenarios-actions",children:[s.jsxs("div",{className:"scenario-block",children:[s.jsx("h5",{className:"scenario-block-title",children:"Shutdown server & delete all data"}),s.jsx("p",{className:"scenario-hint",children:"Wipes chosen server(s) and clears local drafts. Unsaved work is lost unless you had already re-opened and recovered."}),s.jsxs("div",{className:"scenario-buttons",children:[s.jsx("button",{type:"button",className:"scenario-btn scenario-btn-danger",disabled:u,onClick:()=>c(["S1"]),children:h(["S1"],"shutdown")??"On S1 only"}),s.jsx("button",{type:"button",className:"scenario-btn scenario-btn-danger",disabled:u,onClick:()=>c(["S2"]),children:h(["S2"],"shutdown")??"On S2 only"}),s.jsx("button",{type:"button",className:"scenario-btn scenario-btn-danger",disabled:u,onClick:()=>c(["S1","S2"]),children:h(["S1","S2"],"shutdown")??"On both"})]})]}),s.jsxs("div",{className:"scenario-block",children:[s.jsx("h5",{className:"scenario-block-title",children:"Lose server data"}),s.jsx("p",{className:"scenario-hint",children:"Wipes server storage. Local drafts are kept â€” open the desktop to see a recovery notification and recover your work."}),s.jsxs("div",{className:"scenario-buttons",children:[s.jsx("button",{type:"button",className:"scenario-btn scenario-btn-warn",disabled:u,onClick:()=>d(["S1"]),children:h(["S1"],"lose-data")??"On S1 only"}),s.jsx("button",{type:"button",className:"scenario-btn scenario-btn-warn",disabled:u,onClick:()=>d(["S2"]),children:h(["S2"],"lose-data")??"On S2 only"}),s.jsx("button",{type:"button",className:"scenario-btn scenario-btn-warn",disabled:u,onClick:()=>d(["S1","S2"]),children:h(["S1","S2"],"lose-data")??"On both"})]})]})]})]})}function hs({simulateHighLoad:a=!1,onAction:e}){const[n,t]=f.useState(null),r=async(l,c)=>{t(l);try{await c(),e==null||e()}catch(d){const u=d instanceof Error?d.message:String(d);A(`Action failed: ${u}`)}finally{t(null)}};return s.jsxs("div",{className:"dashboard-chart-panel quick-actions",children:[s.jsx("div",{className:"dashboard-chart-header",children:s.jsxs("div",{children:[s.jsx("h4",{children:"Quick actions"}),s.jsx("span",{className:"dashboard-chart-subtitle",children:"Simulate load, kill/restore server, trigger backup"})]})}),s.jsxs("div",{className:"quick-actions-grid",children:[s.jsxs("button",{type:"button",className:`scenario-btn scenario-btn-toggle ${a?"active":""}`,disabled:n!==null,onClick:()=>r("highload",()=>b.simulateHighLoad()),title:a?"Turn off high load":"Simulate high CPU/RAM load",children:[s.jsx("span",{className:"btn-icon","aria-hidden":!0,children:"ðŸ”¥"}),s.jsxs("span",{className:"btn-label",children:[n==="highload"?"â€¦":"Simulate High Load",a&&" (On)"]})]}),s.jsxs("button",{type:"button",className:"scenario-btn scenario-btn-danger",disabled:n!==null,onClick:()=>r("killS1",()=>b.killServer("S1")),title:"Mark server S1 as DOWN",children:[s.jsx("span",{className:"btn-icon","aria-hidden":!0,children:"âš¡"}),s.jsx("span",{className:"btn-label",children:n==="killS1"?"â€¦":"Kill Server S1"})]}),s.jsxs("button",{type:"button",className:"scenario-btn scenario-btn-danger",disabled:n!==null,onClick:()=>r("killS2",()=>b.killServer("S2")),title:"Mark server S2 as DOWN",children:[s.jsx("span",{className:"btn-icon","aria-hidden":!0,children:"âš¡"}),s.jsx("span",{className:"btn-label",children:n==="killS2"?"â€¦":"Kill Server S2"})]}),s.jsxs("button",{type:"button",className:"scenario-btn scenario-btn-restore",disabled:n!==null,onClick:()=>r("restoreS1",()=>b.restoreServer("S1")),title:"Clear forced-down state for S1",children:[s.jsx("span",{className:"btn-icon","aria-hidden":!0,children:"ðŸ”„"}),s.jsx("span",{className:"btn-label",children:n==="restoreS1"?"â€¦":"Restore S1"})]}),s.jsxs("button",{type:"button",className:"scenario-btn scenario-btn-restore",disabled:n!==null,onClick:()=>r("restoreS2",()=>b.restoreServer("S2")),title:"Clear forced-down state for S2",children:[s.jsx("span",{className:"btn-icon","aria-hidden":!0,children:"ðŸ”„"}),s.jsx("span",{className:"btn-label",children:n==="restoreS2"?"â€¦":"Restore S2"})]}),s.jsxs("button",{type:"button",className:"scenario-btn scenario-btn-success",disabled:n!==null,onClick:()=>r("backup",()=>b.triggerBackup()),title:"Trigger a backup run",children:[s.jsx("span",{className:"btn-icon","aria-hidden":!0,children:"âœ“"}),s.jsx("span",{className:"btn-label",children:n==="backup"?"â€¦":"Trigger Backup"})]})]})]})}const us={shutdown:"Server shut down â€” data deleted","lose-data":"Unsaved work lost"};function ps(a,e){const n=e.length===2?"S1 and S2":e[0];return`${a==="shutdown"?`Server(s) ${n} wiped. All file data on the backend is deleted. Any work you had not saved is lost.`:`Server(s) ${n} wiped. Local drafts and the save queue were also cleared.`} Re-open files to see empty or last-saved content.`}function xs({type:a,servers:e,backend:n,onClose:t}){const r=us[a],l=ps(a,e);return s.jsx("div",{className:"modal",role:"dialog","aria-modal":"true","aria-labelledby":"data-loss-title",children:s.jsxs("div",{className:"modal-card data-loss-modal",children:[s.jsx("h3",{id:"data-loss-title",children:r}),s.jsx("p",{children:l}),n&&e.length>0&&s.jsx("p",{className:"data-loss-backend",children:e.map(c=>{var d,u;return s.jsxs("span",{className:"data-loss-server",children:[c,": ",n[c]===!0?"âœ“ wiped":"âœ— failed",((d=n.errors)==null?void 0:d.some(h=>h.startsWith(c)))&&s.jsxs("span",{className:"data-loss-errors",children:[" ","(",(u=n.errors.find(h=>h.startsWith(c)))==null?void 0:u.replace(/^S[12]:\s*/,""),")"]})]},c)})}),s.jsx("div",{className:"modal-actions",children:s.jsx("button",{type:"button",className:"primary",onClick:t,children:"OK"})})]})})}const G={servers:[],mode:"baseline",backup:{status:"idle"},trafficShare:[],avgLatencyMs:0,totalRps:0,simulateHighLoad:!1};function js({onSectionVisible:a}){var j,N;const[e,n]=f.useState(G),[t,r]=f.useState(null),[l,c]=f.useState([]),[d,u]=f.useState(null);f.useEffect(()=>{let i=!0;const S=async()=>{try{const g=await b.getState();if(!i)return;n(g)}catch{if(!i)return;n(g=>g??G)}try{const[g,M]=await Promise.all([b.getMetrics(),b.getEvents()]);if(!i)return;r(g),c(M)}catch{}};S();const L=setInterval(S,3e3);return()=>{i=!1,clearInterval(L)}},[]);const h=()=>{b.getState().then(n).catch(()=>{}),b.getMetrics().then(r).catch(()=>{}),b.getEvents().then(c).catch(()=>{})},p=((e==null?void 0:e.servers)||[]).filter(i=>i.status==="UP").length,o=((e==null?void 0:e.servers)||[]).length;return s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"dashboard-header",children:[s.jsxs("div",{className:"dashboard-header-status",children:[s.jsxs("span",{className:"dashboard-header-status-item",children:[s.jsx("span",{className:`status-dot ${o>0?"online":"offline"}`}),o>0?"System Online":"Controller offline"]}),s.jsxs("span",{className:"dashboard-header-status-item",children:[s.jsx("span",{className:"dashboard-header-icon",children:"â—‡"}),o," nodes Â· ",(e==null?void 0:e.mode)||"baseline"]})]}),s.jsxs("div",{className:"dashboard-header-actions",children:[s.jsxs("button",{type:"button",className:"dashboard-header-btn",onClick:h,children:[s.jsx("span",{children:"â†»"})," Sync Now"]}),s.jsx("button",{type:"button",className:"dashboard-header-avatar","aria-label":"User",children:s.jsx("span",{children:"AQ"})})]})]}),s.jsxs("div",{className:"dashboard-main-inner",children:[s.jsxs("section",{"data-section":"overview",className:"dashboard-hero-section",children:[s.jsxs("div",{className:"dashboard-hero",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"dashboard-hero-title",children:"Smart System Dashboard"}),s.jsx("p",{className:"dashboard-hero-subtitle",children:"Welcome back! Hereâ€™s your system overview for today."})]}),s.jsxs("div",{className:"dashboard-hero-pill",children:[s.jsx("strong",{children:(e==null?void 0:e.mode)||"baseline"})," mode"]})]}),s.jsxs("div",{className:"dashboard-banner",children:[s.jsx("span",{className:"dashboard-banner-badge",children:"â—‡ AmanQ"}),s.jsx("p",{className:"dashboard-banner-text",children:"Live telemetry, traffic routing, and backup state â€” all in one place."}),s.jsx("a",{href:"/workspace",className:"dashboard-banner-cta",children:"Open Workspace â†’"})]}),s.jsxs("div",{className:"dashboard-overview-cards",children:[s.jsxs("div",{className:"dashboard-overview-card",children:[s.jsx("div",{className:"dashboard-overview-card-icon latency",children:s.jsx("span",{children:"âš¡"})}),s.jsx("h4",{children:"Avg Latency"}),s.jsxs("p",{className:"dashboard-overview-value",children:[(e==null?void 0:e.avgLatencyMs)??0," ms"]}),s.jsx("span",{className:"dashboard-overview-change up",children:"Target < 120ms"}),s.jsx("span",{className:"dashboard-overview-dot"})]}),s.jsxs("div",{className:"dashboard-overview-card alert",children:[s.jsx("div",{className:"dashboard-overview-card-icon rps",children:s.jsx("span",{children:"ðŸ“ˆ"})}),s.jsx("h4",{children:"Total RPS"}),s.jsx("p",{className:"dashboard-overview-value",children:(e==null?void 0:e.totalRps)??0}),s.jsx("span",{className:"dashboard-overview-change",children:"Rolling 60s"}),s.jsx("span",{className:"dashboard-overview-dot active"})]}),s.jsxs("div",{className:"dashboard-overview-card",children:[s.jsx("div",{className:"dashboard-overview-card-icon backup",children:s.jsx("span",{children:"ðŸ›¡"})}),s.jsx("h4",{children:"Backup"}),s.jsx("p",{className:"dashboard-overview-value",children:((j=e==null?void 0:e.backup)==null?void 0:j.status)||"idle"}),s.jsx("span",{className:"dashboard-overview-change",children:"Vault OK"})]}),s.jsxs("div",{className:"dashboard-overview-card",children:[s.jsx("div",{className:"dashboard-overview-card-icon nodes",children:s.jsx("span",{children:"ðŸ–¥"})}),s.jsx("h4",{children:"Nodes"}),s.jsxs("p",{className:"dashboard-overview-value",children:[p,"/",o]}),s.jsx("span",{className:"dashboard-overview-change",children:"Online"}),s.jsx("span",{className:"dashboard-overview-dot online"})]})]}),s.jsxs("div",{className:"dashboard-section-head",style:{marginTop:8},children:[s.jsx("h2",{children:"Connection speed"}),s.jsx("span",{className:"dashboard-section-sub",children:"Internet speed per device"})]}),s.jsx("div",{className:"speed-gauges-row",children:((N=e==null?void 0:e.servers)!=null&&N.length?e.servers:[{id:"S1",status:"DOWN",speedMbps:0},{id:"S2",status:"DOWN",speedMbps:0}]).map(i=>s.jsx(J,{deviceId:String(i.id),value:Number(i.speedMbps)||0,max:100,label:"Download speed",unit:"Mbps"},i.id))})]}),s.jsxs("section",{"data-section":"servers",className:"dashboard-section-block",children:[s.jsxs("div",{className:"dashboard-section-head",children:[s.jsx("h2",{children:"Node Map"}),s.jsx("span",{className:"dashboard-section-sub",children:"Health and routing"})]}),s.jsx("div",{className:"dashboard-node-map",children:((e==null?void 0:e.servers)||[]).map(i=>s.jsxs("div",{className:`dashboard-node-map-item ${i.status==="UP"?"up":"down"}`,children:[s.jsx("span",{className:"dashboard-node-map-icon",children:"ðŸ–¥"}),s.jsx("span",{className:"dashboard-node-map-label",children:i.id}),s.jsx("span",{className:"dashboard-node-map-pct",children:i.status==="UP"?`${i.cpu??0}%`:"â€”"})]},i.id))}),s.jsxs("div",{className:"dashboard-section-head",children:[s.jsx("h2",{children:"Servers"}),s.jsx("span",{className:"dashboard-section-sub",children:"CPU, RAM, latency"})]}),s.jsx("div",{className:"server-grid",children:((e==null?void 0:e.servers)||[]).map(i=>s.jsx(X,{server:i},i.id))})]}),s.jsxs("section",{"data-section":"traffic",className:"dashboard-section-block",children:[s.jsxs("div",{className:"dashboard-section-head",children:[s.jsx("h2",{children:"Traffic & Backup"}),s.jsx("span",{className:"dashboard-section-sub",children:"Live charts and security"})]}),s.jsxs("div",{className:"dashboard-chart-hero",children:[s.jsx(as,{data:(t==null?void 0:t.latency)||[]}),s.jsx(rs,{data:(t==null?void 0:t.throughput)||[]})]}),s.jsxs("div",{className:"dashboard-grid",children:[s.jsx(Z,{data:(e==null?void 0:e.trafficShare)||[]}),s.jsx(ds,{backup:e==null?void 0:e.backup})]})]}),s.jsxs("section",{"data-section":"events",className:"dashboard-section-block",children:[s.jsxs("div",{className:"dashboard-section-head",children:[s.jsx("h2",{children:"Events"}),s.jsx("span",{className:"dashboard-section-sub",children:"Failovers and backups"})]}),s.jsx("div",{className:"panel dashboard-log",children:s.jsx(is,{events:l})})]}),s.jsxs("section",{"data-section":"scenarios",className:"dashboard-section-block",children:[s.jsxs("div",{className:"dashboard-section-head",children:[s.jsx("h2",{children:"Quick actions"}),s.jsx("span",{className:"dashboard-section-sub",children:"Simulate load, failover, backup"})]}),s.jsx(hs,{simulateHighLoad:e==null?void 0:e.simulateHighLoad,onAction:h}),s.jsxs("div",{className:"dashboard-section-head",style:{marginTop:24},children:[s.jsx("h2",{children:"Demo scenarios"}),s.jsx("span",{className:"dashboard-section-sub",children:"Simulate shutdown & data loss"})]}),s.jsx(os,{onScenarioDone:u})]}),s.jsxs("section",{"data-section":"settings",className:"dashboard-section-block",children:[s.jsxs("div",{className:"dashboard-section-head",children:[s.jsx("h2",{children:"Settings"}),s.jsx("span",{className:"dashboard-section-sub",children:"Controller and nodes"})]}),s.jsx("div",{className:"panel",children:s.jsx("p",{style:{margin:0,color:"var(--muted)",fontSize:13},children:"Configure controller URL and node endpoints in your environment or app settings."})})]})]}),d&&s.jsx(xs,{type:d.type,servers:d.servers,backend:d.backend,onClose:()=>u(null)})]})}export{js as D};
